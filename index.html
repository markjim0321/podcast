<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Podcast æ’­æ”¾</title>
  <meta name="color-scheme" content="light">
  <style>
    /* â€”â€” åŸºæœ¬æ¨£å¼ï¼ˆç™½åº•è¡Œå‹•å„ªå…ˆï¼‰ â€”â€” */
    :root{--fg:#111;--muted:#6b7280;--line:#e5e7eb;--card:#fff;--accent:#111}
    *{box-sizing:border-box}
    html,body{margin:0;background:#fff;color:var(--fg);font-family:system-ui,-apple-system,"Noto Sans TC",Segoe UI,Arial,sans-serif}
    header{position:sticky;top:0;z-index:10;background:#fff;border-bottom:1px solid var(--line)}
    .bar{max-width:980px;margin:0 auto;padding:12px 16px;display:flex;gap:10px;align-items:center}
    .t{font-size:18px;font-weight:700;margin-right:auto}
    .controls{display:flex;gap:8px;flex:1}
    .select{flex:1;min-width:0;appearance:none;background:#fff;color:var(--fg);border:1px solid var(--line);border-radius:12px;padding:10px 12px;font-size:14px}
    .wrap{max-width:980px;margin:0 auto;padding:14px 16px}
    .grid{display:grid;gap:10px}
    .card{border:1px solid var(--line);border-radius:14px;background:var(--card);padding:12px}
    .title{font-weight:700;line-height:1.35}
    .sub{margin-top:4px;font-size:12px;color:var(--muted)}
    .row{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:10px}
    .btn{border:0;border-radius:10px;background:var(--accent);color:#fff;padding:10px 14px;font-size:14px}
    .empty{color:var(--muted);text-align:center;padding:28px 0}
    footer.player{position:sticky;bottom:0;background:#fff;border-top:1px solid var(--line)}
    .player-inner{max-width:980px;margin:0 auto;padding:8px 16px}
    #now{font-size:14px;margin:4px 0 8px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    audio{width:100%}
    /* å°è¢å¹•å„ªåŒ– */
    @media (min-width:720px){
      .controls{max-width:560px}
      .grid{grid-template-columns:repeat(2,1fr)}
    }
  </style>

  <meta property="og:type" content="website">
<meta property="og:title" content="Podcast æ’­æ”¾ï½œè‡ªç„¶ç§‘ ç¬¬ä¸€å†Š">
<meta property="og:description" content="ç·šä¸Šæ”¶è½ï¼šç”Ÿå‘½çš„ç‰¹æ€§ã€é¤Šåˆ†ã€ç”Ÿç‰©çš„é‹è¼¸èˆ‡é˜²ç¦¦ã€å”èª¿ä½œç”¨ã€æ†å®šæ€§ã€‚">
<meta property="og:url" content="https://markjim0321.github.io/podcast/">
<meta property="og:image" content="https://your-domain.example/cover.jpg">  <!-- æ›æˆä¸€å¼µ 1200x630 åœ– -->
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">

</head>
<body>
  <header>
    <div class="bar">
      <div class="t">Podcast æ’­æ”¾</div>
      <div class="controls">
        <select id="subject" class="select" title="é¸æ“‡ç§‘ç›®">
          <option value="">å…¨éƒ¨ç§‘ç›®</option>
        </select>
        <select id="volume" class="select" title="é¸æ“‡å†Šæ¬¡">
          <option value="">å…¨éƒ¨å†Šæ¬¡</option>
        </select>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div id="list" class="grid"></div>
    <div id="empty" class="empty" style="display:none;">æ²’æœ‰è³‡æ–™</div>
  </main>

  <footer class="player">
    <div class="player-inner">
      <div id="now">å°šæœªæ’­æ”¾</div>
      <audio id="player" controls preload="metadata"></audio>
    </div>
  </footer>

  <script>
    // å–å…ƒç´ 
    const subjectSel = document.getElementById('subject');
    const volumeSel  = document.getElementById('volume');
    const listEl     = document.getElementById('list');
    const emptyEl    = document.getElementById('empty');
    const player     = document.getElementById('player');
    const now        = document.getElementById('now');

    let data = [];           // å…¨éƒ¨æ¸…å–®
    let subjects = new Set();// ç§‘ç›®é›†åˆ
    let volumes  = new Set();// å†Šæ¬¡é›†åˆï¼ˆå¾ URL å¤¾å±¤ /audio/<ç§‘ç›®>/<å†Š>/ å–ï¼‰

    // è®€ podcasts.json
    fetch('./podcasts.json', { cache: 'no-store' })
      .then(r => r.json())
      .then(items => {
        data = Array.isArray(items) ? items : [];
        indexFilters(data);
        renderFilterOptions();
        renderList();
      })
      .catch(err => {
        console.error('è®€å– podcasts.json å¤±æ•—ï¼š', err);
        showEmpty('æ¸…å–®è¼‰å…¥å¤±æ•—');
      });

    // å»ºç«‹ç¯©é¸ï¼ˆç§‘ç›®ã€å†Šæ¬¡ï¼‰
    function indexFilters(items){
      subjects.clear(); volumes.clear();
      for(const it of items){
        if(it.subject) subjects.add(it.subject);
        const vol = extractVolume(it.url);
        if(vol) volumes.add(vol);
        // æŠŠè§£æåˆ°çš„å†Šæ¬¡æ”¾åœ¨ç‰©ä»¶ä¸Šï¼Œä¹‹å¾Œä¸ç”¨é‡ç®—
        it._volume = vol || '';
      }
    }

    // å¾ URL æŠ“å†Šæ¬¡ï¼š.../audio/<subject>/<volume>/æª”å
    function extractVolume(url){
      try{
        const u = new URL(url);
        const parts = decodeURI(u.pathname).split('/').filter(Boolean);
        // pathname ä¾‹ï¼š/podcast_programe/audio/è‡ªç„¶/ç¬¬ä¸€å†Š/XXX.wav
        // æ‰¾åˆ° "audio" çš„ä½ç½®ï¼Œvolume å°±æ˜¯å…¶å¾Œç¬¬ 2 å€‹
        const idx = parts.indexOf('audio');
        if(idx >= 0 && parts.length > idx + 2) return parts[idx+2];
      }catch(e){ /* ignore */ }
      return '';
    }

    // å¡«å…¥ä¸‹æ‹‰é¸é …
    function renderFilterOptions(){
      // ç§‘ç›®
      for(const s of Array.from(subjects).sort()){
        const opt = document.createElement('option');
        opt.value = s; opt.textContent = s;
        subjectSel.appendChild(opt);
      }
      // å†Šæ¬¡
      for(const v of Array.from(volumes).sort()){
        const opt = document.createElement('option');
        opt.value = opt.textContent = v;
        volumeSel.appendChild(opt);
      }
    }

    // ç¯©é¸ + æ¸²æŸ“æ¸…å–®
    function renderList(){
      const subj = subjectSel.value;
      const vol  = volumeSel.value;

      // ç¯©é¸
      const rows = data.filter(it =>
        (!subj || it.subject === subj) &&
        (!vol  || it._volume === vol)
      );

      listEl.innerHTML = '';
      if(!rows.length) return showEmpty('æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„æª”æ¡ˆ');

      emptyEl.style.display = 'none';

      // ä¾æ—¥æœŸæ–°åˆ°èˆŠ
      rows.sort((a,b) => (b.date||'').localeCompare(a.date||''));

      for(const it of rows){
        const card  = document.createElement('div');
        card.className = 'card';

        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = it.title || '(æœªå‘½å)';

        const sub   = document.createElement('div');
        sub.className = 'sub';
        const parts = [];
        if(it.subject) parts.push(it.subject);
        if(it._volume) parts.push(it._volume);
        if(it.date)    parts.push(it.date);
        if(it.duration)parts.push(it.duration);
        sub.textContent = parts.join(' ï½œ ');

        const row   = document.createElement('div');
        row.className = 'row';

        const btn   = document.createElement('button');
        btn.className = 'btn';
        btn.textContent = 'æ’­æ”¾';
        btn.onclick = () => play(it);

        row.appendChild(btn);

        card.appendChild(title);
        card.appendChild(sub);
        card.appendChild(row);
        listEl.appendChild(card);
      }
    }

    function showEmpty(msg){
      listEl.innerHTML = '';
      emptyEl.style.display = '';
      emptyEl.textContent = msg || 'æ²’æœ‰è³‡æ–™';
    }

    function play(item){
      // ç›´æ¥ä½¿ç”¨åŸå§‹ URLï¼ˆä¸åš encodeï¼‰
      player.src = item.url;
      player.play().catch(e => console.error('play() å¤±æ•—ï¼š', e));
      now.textContent = `ğŸµ æ­£åœ¨æ’­æ”¾ï¼š${item.title || '(æœªå‘½å)'}`;

      // è‹¥æœªæä¾›æ™‚é•·ï¼Œè¼‰å…¥å¾Œé¡¯ç¤º
      player.onloadedmetadata = () => {
        if(!item.duration && player.duration && isFinite(player.duration)){
          const s = Math.round(player.duration);
          const mm = String(Math.floor(s/60)).padStart(2,'0');
          const ss = String(s%60).padStart(2,'0');
          now.textContent = `ğŸµ æ­£åœ¨æ’­æ”¾ï¼š${item.title || '(æœªå‘½å)'}ï¼ˆ${mm}:${ss}ï¼‰`;
        }
      };
    }

    // ç›£è½ä¸‹æ‹‰
    subjectSel.addEventListener('change', renderList);
    volumeSel.addEventListener('change', renderList);
  </script>
</body>
</html>
